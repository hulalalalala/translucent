(function($,window,document,undefined){var Translucent=function(elem,options){this.elem=elem;this.$elem=$(elem);this.options=options;this.$win=$(window);this.$doc=$(document);this.docHeight=this.$doc.height()};Translucent.prototype={defaults:{width:500,height:500,drag:true,opacity:0.8,border:"1px solid #ddd",borderRadius:8,wallGlass:false,backgroundColor:"rgb(225, 225, 225)",titleHeight:"40px",titleGroundColor:"#999",shadow:true,positionTop:100,positionLeft:100,titleText:"新建弹窗",titleFontSize:12,titleFontColor:"#000",titleFontFamily:"微软雅黑",textHtml:"<p>这是一个新建的弹窗！</p>",titleTextCenter:false,_isScale:true,_isMax:true},init:function(){this.config=$.extend({},this.defaults,this.options);this.drawInfoWindow();if(this.config.drag){this.dragWindow();$(".translucent-title").addClass("translucent-move")}this.smallWindow();this.closeWindow()},drawInfoWindow:function(){var context=this;context.$elem.addClass("translucent-relative");var html="";html+='<div class="translucent-container">';html+='<div class="translucent-title"><span>'+context.config.titleText+'</span><div class="translucent-control"><img id="translucent_small" title="最小化" src="translucent/icon/small.png"/><img id="translucent_close" title="关闭" src="translucent/icon/close.png"/></div></div>';html+='<div class="translucent-content">'+context.config.textHtml+"</div>";html+="</div>";context.$elem.append(html);var translucentContainer=$(".translucent-container");var translucentTitle=$(".translucent-title");translucentContainer.css({width:context.config.width,height:context.config.height,backgroundColor:context.config.backgroundColor,top:context.config.positionTop,left:context.config.positionLeft,opacity:context.config.opacity,border:context.config.border,borderRadius:context.config.borderRadius}).addClass("translucent-absolute");if(context.config.shadow){translucentContainer.addClass("translucent-shadow")}translucentTitle.css({height:context.config.titleHeight,backgroundColor:context.config.titleGroundColor,fontSize:context.config.titleFontSize,color:context.config.titleFontColor,fontFamily:context.config.titleFontFamily});
if(context.config.titleTextCenter){translucentTitle.addClass("translucent-center")}translucentTitle.find("span").css({lineHeight:context.config.titleHeight,marginLeft:10});var _titleHeight=translucentTitle.height();var _top=(_titleHeight-20)/2;$(".translucent-control").css({top:0,height:context.config.titleHeight,lineHeight:context.config.titleHeight})},smallWindow:function(){var context=this;var translucentContainer=$(".translucent-container");var translucentContent=$(".translucent-content");var translucentControl=$(".translucent-control");translucentControl.bind("click",function(e){e.preventDefault();e.stopPropagation()});$("#translucent_small").bind("click",function(e){var top=$("body").height()-parseInt(context.config.titleHeight)-6;if(context.defaults._isScale){translucentContainer.animate({height:context.config.titleHeight,top:top,left:0,width:"230px"});translucentContent.hide();$(this).attr("src","translucent/icon/fangda.png");$(this).attr("title","还原");context.defaults._isScale=false}else{translucentContainer.animate({height:context.config.height,left:context.config.positionLeft,top:context.config.positionTop,width:context.config.width});translucentContent.show();$(this).attr("src","translucent/icon/small.png");$(this).attr("title","最小化");context.defaults._isScale=true}e.preventDefault();e.stopPropagation()})},closeWindow:function(){$("#translucent_close").bind("click",function(){$(".translucent-container").remove()})},maxWindow:function(){var context=this;var translucentBig=$("#translucent_big");var translucentContainer=$(".translucent-container");var translucentContent=$(".translucent-content");var translucentControl=$(".translucent-control");var translucentSmall=$("#translucent_small");var $body=$("body");translucentBig.bind("click",function(e){var height=$body.height();var width=$body.width();if(context.config._isMax){translucentContainer.animate({height:height,top:0,left:0,width:width});translucentSmall.attr("src","translucent/icon/small.png");translucentSmall.attr("title","最小化");
context.config._isMax=false}else{translucentContainer.animate({height:context.config.height,left:context.config.positionLeft,top:context.config.positionTop,width:context.config.width});context.config._isMax=true}})},dragWindow:function(){var context=this;function drag(obj1,obj3){obj1.mousedown(function(ev){if(context.defaults._isScale&&context.config._isMax){var dx=ev.clientX||ev.pageX;var dy=ev.clientY||ev.pageY;var dialogleft=obj3.offset().left;var dialogtop=obj3.offset().top;context.config.positionLeft=dialogleft;context.config.positionTop=dialogtop;var flag=true;$(document).mousemove(function(e){if(flag){var bodyWidth=$("body").width()-context.config.width;var bodyHeight=$("body").height()-context.config.height;var mx=e.clientX||e.pageX;var my=e.clientY||e.pageY;var _left=mx-dx+dialogleft;var _top=my-dy+dialogtop;if(_left<0){return}if(_top<0){return}if(_left>bodyWidth){return}if(_top>bodyHeight){return}obj3.css({"left":_left+"px","top":_top+"px"})}}).mouseup(function(){flag=false})}})}drag($(".translucent-title"),$(".translucent-container"))}};$.fn.translucent=function(options){new Translucent(this,options).init()}})(jQuery,window,document);
